%% Client Architecture: Rendering Flow (Full vs Incremental)
%% Sequence diagram showing rendering decision and execution

sequenceDiagram
    participant NetworkedMode as Networked Mode
    participant StateComparison as StateComparison
    participant Renderer as Renderer
    participant ANSI as ANSI Escapes
    participant Chalk as Chalk
    
    Note over NetworkedMode,Chalk: Rendering Flow Decision
    
    NetworkedMode->>NetworkedMode: State update or input received
    NetworkedMode->>NetworkedMode: Check if previousState exists
    
    alt previousState is null
        Note over NetworkedMode: Initial render - use full render
        NetworkedMode->>Renderer: renderFull(board, players, score)
        Renderer->>ANSI: eraseScreen()
        Renderer->>Renderer: renderTitle()
        Renderer->>Renderer: renderBoard(board, players)
        Renderer->>Renderer: renderStatusBar(score, position)
        Renderer-->>NetworkedMode: Full render complete
    else previousState exists
        NetworkedMode->>StateComparison: compareStates(previousState, currentState)
        StateComparison-->>NetworkedMode: Changes object
        
        NetworkedMode->>NetworkedMode: Count total changes
        
        alt Too many changes (>10)
            Note over NetworkedMode: Too many changes - use full render
            NetworkedMode->>Renderer: renderFull(board, players, score)
            Renderer->>ANSI: eraseScreen()
            Renderer->>Renderer: renderTitle()
            Renderer->>Renderer: renderBoard(board, players)
            Renderer->>Renderer: renderStatusBar(score, position)
            Renderer-->>NetworkedMode: Full render complete
        else Incremental render
            Note over NetworkedMode: Small changes - use incremental render
            NetworkedMode->>Renderer: renderIncremental(changes, board, players)
            
            loop For each moved player
                Renderer->>Renderer: restoreCellContent(oldX, oldY)
                Renderer->>ANSI: cursorTo(x, y)
                Renderer->>Renderer: Draw restored content
                Renderer->>Renderer: getCellContent(newX, newY)
                Renderer->>Chalk: Apply color styling
                Renderer->>ANSI: cursorTo(newX, newY)
                Renderer->>Renderer: Draw player at new position
            end
            
            loop For each joined player
                Renderer->>Renderer: getCellContent(x, y)
                Renderer->>Chalk: Apply color styling
                Renderer->>ANSI: cursorTo(x, y)
                Renderer->>Renderer: Draw player
            end
            
            loop For each left player
                Renderer->>Renderer: restoreCellContent(x, y)
                Renderer->>ANSI: cursorTo(x, y)
                Renderer->>Renderer: Draw restored content
            end
            
            alt Score or position changed
                Renderer->>Renderer: renderStatusBar(score, position)
            end
            
            Renderer-->>NetworkedMode: Incremental render complete
        end
    end
