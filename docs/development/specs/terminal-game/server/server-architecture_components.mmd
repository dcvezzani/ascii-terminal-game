%% Server Architecture Component Structure Diagram
%% Server architecture component structure (terminal-game/server/)

graph TB
    %% Entry Point
    EntryPoint["Entry Point\nsrc/server/index.js\n\nPurpose: Server initialization\nand lifecycle management\n\nPattern: Factory/Initialization\n\nResponsibilities:\n• Load config\n• Configure logger\n• Parse board path\n• Load board via loader\n• Create Board and Game\n• Build spawn options\n• Create Server(port, game, options)\n• Graceful shutdown"]
    
    %% Server (Facade)
    Server["Server\nsrc/server/server.js\n\nPurpose: WebSocket server\nand message orchestration\n\nPattern: Facade\n\nResponsibilities:\n• WebSocket lifecycle\n• Connection handling\n• Message routing\n• State broadcasting\n• Client-to-player mapping"]
    
    %% ConnectionManager
    ConnectionManager["ConnectionManager\nsrc/server/ConnectionManager.js\n\nPurpose: Connection lifecycle\nand metadata management\n\nPattern: Registry/Manager\n\nData Structures:\n• connections: Map\n• playerIdMap: Map\n\nResponsibilities:\n• Track connections\n• Map clientId to playerId\n• Store metadata"]
    
    %% GameServer
    GameServer["GameServer\nsrc/server/GameServer.js\n\nPurpose: Game state management\nand player operations\n\nPattern: Domain Model\n\nData Structures:\n• players: Map\n\nResponsibilities:\n• Player lifecycle\n• Move validation\n• State serialization\n• Collision detection"]
    
    %% Game
    Game["Game\nsrc/game/Game.js\n\nPurpose: Core game state\ncontainer\n\nPattern: Aggregate Root\n\nState:\n• board (from loader)\n• score: number\n• running: boolean\n\nResponsibilities:\n• Holds board from loader\n• Score tracking\n• Game running state"]
    
    %% Board
    Board["Board\nsrc/game/Board.js\n\nPurpose: Game board grid\nrepresentation\n\nPattern: Value Object\n\nData Structure:\n• grid: 2D array\n  - ' ' empty\n  - '#' wall\n  - ' ' spawn (from loader)\n\nResponsibilities:\n• Cell access\n• Wall checking\n• Serialization"]
    
    %% MessageHandler
    MessageHandler["MessageHandler\nsrc/network/MessageHandler.js\n\nPurpose: Message parsing\nand creation utilities\n\nPattern: Utility/Helper\n\nFunctions:\n• parseMessage()\n• createMessage()\n\nResponsibilities:\n• Parse JSON\n• Validate structure\n• Add timestamps"]
    
    %% MessageTypes
    MessageTypes["MessageTypes\nsrc/network/MessageTypes.js\n\nPurpose: Message type\nconstants\n\nPattern: Constants/Enum\n\nTypes:\n• CONNECT\n• MOVE\n• STATE_UPDATE"]
    
    %% External Dependencies
    WebSocketServer["WebSocketServer\n(ws library)\n\nExternal dependency"]
    
    Logger["Logger\n(winston)\n\nExternal dependency"]
    
    Config["Config\nserverConfig.js\n\nConfiguration"]
    
    %% Relationships - Composition (strong ownership)
    EntryPoint -->|creates & starts| Server
    Server -->|owns| ConnectionManager
    Server -->|owns| GameServer
    GameServer -->|owns| Game
    Game -->|owns| Board
    
    %% Relationships - Dependency (uses)
    Server -->|uses| MessageHandler
    Server -->|uses| MessageTypes
    Server -->|uses| WebSocketServer
    Server -->|uses| Logger
    EntryPoint -->|uses| Config
    EntryPoint -->|uses| Logger
    GameServer -->|uses| Logger
    MessageHandler -->|uses| MessageTypes
    
    %% Styling
    classDef entryPoint fill:#e1f5ff,stroke:#01579b,stroke-width:3px
    classDef facade fill:#fff3e0,stroke:#e65100,stroke-width:3px
    classDef manager fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef domain fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px
    classDef utility fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    classDef external fill:#f5f5f5,stroke:#616161,stroke-width:2px,stroke-dasharray: 5 5
    
    class EntryPoint entryPoint
    class Server facade
    class ConnectionManager,GameServer manager
    class Game,Board domain
    class MessageHandler,MessageTypes utility
    class WebSocketServer,Logger,Config external
