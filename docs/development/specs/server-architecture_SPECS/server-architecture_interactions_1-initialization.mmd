%% Server Architecture: Server Initialization Flow
%% Sequence diagram showing server startup sequence

sequenceDiagram
    participant EP as Entry Point<br/>(index.js)
    participant Config as Config<br/>(serverConfig.js)
    participant Logger as Logger<br/>(winston)
    participant Server as Server<br/>(server.js)
    participant WSS as WebSocketServer<br/>(ws)
    participant CM as ConnectionManager
    participant GS as GameServer
    participant Game as Game
    participant Board as Board
    
    Note over EP: Server Startup Sequence
    
    EP->>Config: Load configuration
    Config-->>EP: Return config object
    
    EP->>Logger: Configure logger (server mode)
    Logger-->>EP: Logger configured
    
    EP->>Server: new Server(port)
    Server->>CM: new ConnectionManager()
    Server->>GS: new GameServer(width, height)
    GS->>Game: new Game(width, height)
    Game->>Board: new Board(width, height)
    Game->>Board: initialize()
    Board-->>Game: Grid initialized
    Game-->>GS: Game instance created
    GS-->>Server: GameServer ready
    CM-->>Server: ConnectionManager ready
    Server-->>EP: Server instance created
    
    EP->>Server: await start()
    Server->>WSS: new WebSocketServer({ port })
    WSS-->>Server: WebSocketServer created
    
    Server->>WSS: Register event handlers
    Server->>Server: startBroadcasting()
    WSS->>WSS: Start listening
    WSS-->>Server: 'listening' event
    Server-->>EP: Server started
